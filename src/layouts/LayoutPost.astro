---
import Layout from './Layout.astro';

interface Props {
  title: string;
  categories?: any[];
  tags?: any[];
  [key: string]: any;
}

import { Picture } from 'astro:assets';

const { title, categories, tags, featured_image, ...props } = Astro.props;
---

<Layout title={title}>
    <!-- Specific structure for Posts -->
    <article class="post-container container mx-auto py-12">
        <header class="mb-8 border-b pb-8">
            <div class="text-sm breadcrumbs mb-4">
                <ul>
                    <li><a href="/blog">Blog</a></li>
                    <li>{title}</li>
                </ul>
            </div>
            <h1 class="text-5xl font-bold mb-4">{title}</h1>
            
            <div class="meta flex gap-4 text-sm text-gray-500 mb-6">
                {categories && (
                    <span class="categories">
                        Categoría: {categories.map(c => c.name).join(', ')}
                    </span>
                )}
            </div>

            {featured_image && featured_image.local_url && (
                <div class="featured-image mb-8 rounded-xl overflow-hidden shadow-lg">
                    {/* 
                      OPTIMIZACION CRITICA:
                      Usamos http://localhost:8686 explícitamente para que el servidor de Astro
                      lea la imagen de sí mismo por la red interna (Loopback) en lugar de salir 
                      a internet a buscar "sodeco.dev.net.pe" o la URL pública.
                      Esto reduce el tiempo de "Descarga" de ms/segundos a microsegundos.
                    */}
                    <Picture 
                        src={`http://localhost:8686${featured_image.local_url}`}
                        alt={featured_image.alt || title} 
                        width={1200}
                        height={600}
                        formats={['avif', 'webp']}
                        widths={[240, 540, 720, 1024, 1200]}
                        sizes={`(max-width: 360px) 240px, (max-width: 720px) 540px, (max-width: 1024px) 720px, 1200px`}
                        class="w-full h-auto object-cover max-h-[600px]"
                        loading="eager"
                        decoding="async"
                    />
                </div>
            )}
        </header>
        
        <main class="prose max-w-none">
            <slot />
            <div class="debug-data mt-8 p-4 bg-base-200 rounded text-xs opacity-50">
               <pre>{JSON.stringify(props, null, 2)}</pre>
            </div>
        </main>

        <footer class="mt-12 pt-8 border-t">
             {tags && (
                <div class="tags flex gap-2">
                    {tags.map(t => (
                        <span class="badge badge-outline">#{t.name}</span>
                    ))}
                </div>
            )}
        </footer>
    </article>
</Layout>
