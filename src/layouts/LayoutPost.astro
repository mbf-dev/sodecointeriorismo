---
import Layout from './Layout.astro';

interface Props {
  title: string;
  categories?: any[];
  tags?: any[];
  [key: string]: any;
}

const { title, categories, tags, featured_image, ...props } = Astro.props;
---

<Layout title={title}>
    <!-- Specific structure for Posts -->
    <article class="post-container container mx-auto py-12">
        <header class="mb-8 border-b pb-8">
            <div class="text-sm breadcrumbs mb-4">
                <ul>
                    <li><a href="/blog">Blog</a></li>
                    <li>{title}</li>
                </ul>
            </div>
            <h1 class="text-5xl font-bold mb-4">{title}</h1>
            
            <div class="meta flex gap-4 text-sm text-gray-500 mb-6">
                {categories && (
                    <span class="categories">
                        Categoría: {categories.map(c => c.name).join(', ')}
                    </span>
                )}
            </div>

            {/* 
              Renderizado ULTRA RÁPIDO con Optimización Pre-Sync 
              - Usa 'optimized.lqip' (Base64 tiny) para carga instantánea.
              - Usa 'optimized.sources' para WebP/AVIF servidos desde disco (sin procesar al vuelo).
            */}
            {featured_image && featured_image.optimized ? (
                <div 
                    class="featured-image mb-8 rounded-xl overflow-hidden shadow-lg relative bg-cover bg-center"
                    style={`background-image: url('${featured_image.optimized.lqip}');`}
                >
                    {/* Filtro blur para el LQIP de fondo */}
                    <div class="absolute inset-0 backdrop-blur-xl z-0"></div>

                    <picture class="relative z-10 block w-full h-auto">
                        {featured_image.optimized.sources.map((source: any) => (
                            <source srcset={source.srcset} type={source.type} sizes="(max-width: 640px) 640px, (max-width: 1024px) 1024px, 1600px" />
                        ))}
                        <img 
                            src={featured_image.optimized.src} 
                            alt={featured_image.alt || title} 
                            width={featured_image.optimized.width}
                            height={featured_image.optimized.height}
                            loading="eager"
                            decoding="async"
                            class="w-full h-auto object-cover max-h-[600px] transition-opacity duration-500 opacity-0 onload-opacity"
                            onload="this.style.opacity=1"
                        />
                    </picture>
                </div>
            ) : (
               /* Fallback por si no hay optimización (legacy) */
               featured_image && featured_image.url && (
                 <div class="mb-8">
                    <img src={featured_image.url} alt={title} class="w-full h-auto rounded-xl" />
                 </div>
               )
            )}
        </header>
        
        <main class="prose max-w-none">
            <slot />
            <div class="debug-data mt-8 p-4 bg-base-200 rounded text-xs opacity-50">
               <pre>{JSON.stringify(props, null, 2)}</pre>
            </div>
        </main>

        <footer class="mt-12 pt-8 border-t">
             {tags && (
                <div class="tags flex gap-2">
                    {tags.map(t => (
                        <span class="badge badge-outline">#{t.name}</span>
                    ))}
                </div>
            )}
        </footer>
    </article>
</Layout>
